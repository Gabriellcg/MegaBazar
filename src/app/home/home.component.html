<div class="home-container">

  <header class="header">
    <div class="container">
      <div class="header-content">

        <button class="menu-btn" (click)="toggleMenu()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M3 12h18M3 6h18M3 18h18" stroke-width="2" stroke-linecap="round" />
          </svg>
        </button>

        <h1 class="logo">MegaLoja Online</h1>

        <div class="search-bar desktop">
          <input type="text" placeholder="Buscar produtos..." class="search-input" [(ngModel)]="termoBusca"
            (input)="buscarProdutos($event)">
          <button class="search-btn" *ngIf="!buscaAtiva">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
          </button>
          <button class="search-btn btn-clear" *ngIf="buscaAtiva" (click)="limparBusca()">
            ‚úï
          </button>
        </div>

        <div class="header-icons">
          <button class="icon-btn">üë§
          </button>
          <button class="icon-btn" [routerLink]="['/meus-pedidos']" title="Meus Pedidos">üì¶
          </button>
          <button class="icon-btn cart-btn" [routerLink]="['/carrinho']">üõí
            <span class="cart-badge" *ngIf="carrinhoCount > 0">{{ carrinhoCount }}</span>
          </button>
        </div>
      </div>

      <div class="search-bar mobile">
        <input type="text" placeholder="Buscar produtos..." class="search-input" [(ngModel)]="termoBusca"
          (input)="buscarProdutos($event)">
        <button class="search-btn" *ngIf="!buscaAtiva">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
        </button>
        <button class="search-btn btn-clear" *ngIf="buscaAtiva" (click)="limparBusca()">
          ‚úï
        </button>
      </div>
    </div>
  </header>


  <main class="main-content">
    <div class="container">


      <div *ngIf="loading" class="loading-message">
        <p>Carregando produtos...</p>
      </div>


      <div *ngIf="erro && !loading" class="error-message">
        <p>{{ erro }}</p>
      </div>


      <section class="section" *ngIf="!loading && promocoesFiltradas && promocoesFiltradas.length > 0">
        <h2 class="section-title promocoes">
          {{ buscaAtiva ? 'Promo√ß√µes encontradas' : 'Promo√ß√µes Rel√¢mpagos' }}
          <span class="resultado-count" *ngIf="buscaAtiva">({{ promocoesFiltradas.length }})</span>
        </h2>

        <div class="products-grid">
          <div class="product-card" *ngFor="let produto of promocoesFiltradas">

            <div class="product-image" [routerLink]="['/produto', produto.id]">
              <img [src]="produto.imagem" [alt]="produto.nome">
              <div class="discount-badge" *ngIf="produto.precoAntigo">
                -{{ calcularDesconto(produto) }}%
              </div>
            </div>


            <div class="product-info">
              <h3 class="product-name" [routerLink]="['/produto', produto.id]">{{ produto.nome }}</h3>


              <div class="rating">
                <span *ngFor="let estrela of getArrayEstrelas(produto.rating)"
                  [class.filled]="isEstrelaPreenchida(estrela, produto.rating)" class="star">
                  ‚òÖ
                </span>
                <span class="rating-value">({{ produto.rating }})</span>
              </div>


              <p class="old-price" *ngIf="produto.precoAntigo">
                R$ {{ produto.precoAntigo }}
              </p>

              <p class="price">
                R$ {{ produto.preco }}
              </p>

              <p class="installments">
                ou {{ produto.parcelas }}x de R$ {{ calcularParcela(produto) }}
              </p>


              <button class="btn-add-cart" (click)="adicionarAoCarrinho(produto)">
                Adicionar ao Carrinho
              </button>
            </div>
          </div>
        </div>
      </section>


      <section class="section" *ngIf="!loading && lancamentosFiltrados && lancamentosFiltrados.length > 0">
        <h2 class="section-title lancamentos">
          {{ buscaAtiva ? 'Lan√ßamentos encontrados' : 'Lan√ßamentos' }}
          <span class="resultado-count" *ngIf="buscaAtiva">({{ lancamentosFiltrados.length }})</span>
        </h2>

        <div class="products-grid lancamentos-grid">
          <div class="product-card" *ngFor="let produto of lancamentosFiltrados">

            <div class="product-image" [routerLink]="['/produto', produto.id]">
              <img [src]="produto.imagem" [alt]="produto.nome">
            </div>


            <div class="product-info">
              <h3 class="product-name" [routerLink]="['/produto', produto.id]">{{ produto.nome }}</h3>


              <div class="rating">
                <span *ngFor="let estrela of getArrayEstrelas(produto.rating)"
                  [class.filled]="isEstrelaPreenchida(estrela, produto.rating)" class="star">
                  ‚òÖ
                </span>
                <span class="rating-value">({{ produto.rating }})</span>
              </div>


              <p class="price">
                R$ {{ produto.preco }}
              </p>

              <p class="installments">
                ou {{ produto.parcelas }}x de R$ {{ calcularParcela(produto) }}
              </p>


              <button class="btn-add-cart" (click)="adicionarAoCarrinho(produto)">
                Adicionar ao Carrinho
              </button>
            </div>
          </div>
        </div>
      </section>


      <div *ngIf="!loading && buscaAtiva && promocoesFiltradas.length === 0 && lancamentosFiltrados.length === 0"
        class="no-products">
        <div class="no-results-icon">üîç</div>
        <h3>Nenhum produto encontrado</h3>
        <p>N√£o encontramos produtos com o termo "<strong>{{ termoBusca }}</strong>"</p>
        <button class="btn-clear-search" (click)="limparBusca()">Limpar busca</button>
      </div>

      <div
        *ngIf="!loading && !buscaAtiva && (!promocoes || promocoes.length === 0) && (!lancamentos || lancamentos.length === 0)"
        class="no-products">
        <p>Nenhum produto dispon√≠vel no momento.</p>
      </div>

    </div>
  </main>


  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-col">
          <h3>Sobre N√≥s</h3>
          <p>A melhor loja online com os melhores pre√ßos e condi√ß√µes de pagamento.</p>
        </div>
        <div class="footer-col">
          <h3>Atendimento</h3>
          <p>
            Segunda a Sexta: 8h √†s 18h<br>
            S√°bado: 8h √†s 12h
          </p>
        </div>
        <div class="footer-col">
          <h3>Contato</h3>
          <p>
            Email: contato@megaloja.com<br>
            Tel: (11) 1234-5678
          </p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>¬© 2024 MegaLoja Online. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>
</div>

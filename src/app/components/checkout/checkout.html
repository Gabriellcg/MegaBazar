
<div class="checkout-container">

  <div class="promo-banner">
    Para frete gr√°tis em pedidos acima de R$100,00 ou mais, use o c√≥digo FRETEFREE
  </div>

  <header class="header">
    <div class="container">
      <div class="header-content">
        <h1 class="logo" [routerLink]="['/']">MegaLoja Online</h1>
        <div class="header-icons">
          <button class="icon-btn">üë§</button>
          <button class="icon-btn" [routerLink]="['/carrinho']">üõí</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <div class="container">
      <button class="back-btn" (click)="voltarParaCarrinho()">‚Üê Voltar</button>
    </div>
  </div>

  <main class="main-content">
    <div class="container">
      <div class="checkout-grid">

        <div class="left-column">
          <h2 class="section-title">Vis√£o geral dos itens</h2>

          <div class="order-summary-box">
            <p class="summary-text">
              Voc√™ est√° comprando <strong>{{ itens.length }} {{ itens.length === 1 ? 'produto' : 'produtos' }}</strong>,
              valor total de <strong>R$ {{ formatarPreco(subtotal) }}</strong>
            </p>
          </div>

          <div class="items-list">
            <div class="item-card-mini" *ngFor="let item of itens">
              <div class="item-mini-image">
                <img [src]="item.produto.imagem" [alt]="item.produto.nome">
              </div>
              <div class="item-mini-info">
                <h4>{{ item.produto.nome }}</h4>
                <p class="item-mini-price">R$ {{ formatarPreco(item.produto.preco) }} /un Qtd.</p>
                <p class="item-mini-qty">Quantidade: {{ item.quantidade }}</p>
              </div>
            </div>
          </div>

          <div class="cupom-section">
            <h3>Como deseja receber?</h3>


            <div class="modalidade-entrega">
              <button
                type="button"
                class="modalidade-btn"
                [class.active]="modalidadeEntrega === 'entrega'"
                (click)="selecionarModalidadeEntrega('entrega')">
                <span class="icon">üöö</span>
                <div class="modalidade-info">
                  <strong>Entrega Padr√£o</strong>
                  <p>Receba em casa</p>
                </div>
              </button>

              <button
                type="button"
                class="modalidade-btn"
                [class.active]="modalidadeEntrega === 'retirada'"
                (click)="selecionarModalidadeEntrega('retirada')">
                <span class="icon">üè™</span>
                <div class="modalidade-info">
                  <strong>Retirar na Loja</strong>
                  <p>Sem custo de frete</p>
                </div>
              </button>
            </div>

            <div *ngIf="modalidadeEntrega === 'retirada'" class="lojas-section">
              <div class="buscar-lojas-header">
                <h4>Selecione uma loja para retirada</h4>
                <button
                  type="button"
                  class="btn-buscar-lojas"
                  (click)="buscarLojasProximas()"
                  [disabled]="!checkoutForm.get('cep')?.value">
                  üìç Buscar lojas pr√≥ximas ao CEP
                </button>
              </div>

              <div *ngIf="!mostrarLojas && lojasDisponiveis.length > 0" class="lojas-info">
                <p>üí° Temos {{ lojasDisponiveis.length }} lojas dispon√≠veis. Informe seu CEP para ver as mais pr√≥ximas.</p>
              </div>

              <div *ngIf="mostrarLojas && lojasDisponiveis.length > 0" class="lojas-lista">
                <div
                  *ngFor="let loja of lojasDisponiveis"
                  class="loja-card"
                  [class.selected]="lojaSelecionada?.id === loja.id"
                  (click)="selecionarLoja(loja)">

                  <div class="loja-header">
                    <div class="loja-radio">
                      <input
                        type="radio"
                        [checked]="lojaSelecionada?.id === loja.id"
                        [id]="'loja-' + loja.id"
                        name="loja">
                    </div>
                    <div class="loja-info">
                      <h5>{{ loja.nome }}</h5>
                      <p class="loja-endereco">{{ getEnderecoLoja(loja) }}</p>
                      <p class="loja-horario">‚è∞ {{ loja.horarioFuncionamento }}</p>
                      <p class="loja-telefone">üìû {{ loja.telefone }}</p>
                      <div *ngIf="loja.distancia" class="loja-distancia">
                        <span class="badge-distancia">üìç {{ loja.distancia }} km</span>
                        <span class="badge-tempo">üïê {{ loja.tempoEstimado }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="lojaSelecionada" class="loja-selecionada-badge">
                ‚úÖ Loja selecionada: <strong>{{ lojaSelecionada.nome }}</strong>
              </div>
            </div>
          </div>


          <div class="delivery-section">
            <h3>Informa√ß√µes de frete para entrega:</h3>
            <div class="delivery-info-card">
              <div class="delivery-info-item">
                <strong>Casa Centro - 2,3 km</strong>
                <p>Rua Principal, 100 - Centro</p>
                <p>S√£o Paulo, SP, CEP: 01001-000</p>
                <p><strong>Previs√£o:</strong> 3 horas</p>
                <p><strong>Valor de frete:</strong> {{ frete === 0 ? 'GR√ÅTIS' : 'R$ ' + formatarPreco(frete) }}</p>
              </div>
              <div class="delivery-info-item">
                <strong>Casa Shoppings Norte - 3,1 km</strong>
                <p>Rua das Lojas, 100 - Fase 2</p>
                <p>S√£o Paulo, SP, CEP: 01002-000</p>
                <p><strong>Previs√£o:</strong> 5-7h</p>
                <p><strong>Promo√ß√£o:</strong> em 3 horas</p>
                <p><strong>Valor de frete:</strong> Incluso</p>
              </div>
            </div>
          </div>

        </div>


        <div class="right-column">
          <h2 class="section-title">Detalhes do pagamento</h2>

          <form [formGroup]="checkoutForm" (ngSubmit)="finalizarPedido()">


            <div class="form-section">
              <h3 class="form-section-title">Dados</h3>

              <div class="form-group">
                <label for="nomeCompleto">Nome completo</label>
                <input
                  type="text"
                  id="nomeCompleto"
                  formControlName="nomeCompleto"
                  [class.invalid]="isInvalido('nomeCompleto')"
                  placeholder="Digite seu nome completo">
                <span class="error-message" *ngIf="isInvalido('nomeCompleto')">
                  Nome completo √© obrigat√≥rio
                </span>
              </div>

              <div class="form-group">
                <label for="email">E-mail</label>
                <input
                  type="email"
                  id="email"
                  formControlName="email"
                  [class.invalid]="isInvalido('email')"
                  placeholder="seu@email.com">
                <span class="error-message" *ngIf="isInvalido('email')">
                  E-mail v√°lido √© obrigat√≥rio
                </span>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="telefone">Telefone</label>
                  <input
                    type="tel"
                    id="telefone"
                    formControlName="telefone"
                    [class.invalid]="isInvalido('telefone')"
                    placeholder="(11) 99999-9999">
                </div>
                <div class="form-group">
                  <label for="cpf">CPF</label>
                  <input
                    type="text"
                    id="cpf"
                    formControlName="cpf"
                    [class.invalid]="isInvalido('cpf')"
                    placeholder="000.000.000-00">
                </div>
              </div>
            </div>


            <div class="form-section">
              <h3 class="form-section-title">Endere√ßo de entrega</h3>

              <div class="form-group">
                <label for="cep">CEP</label>
                <div class="input-with-button">
                  <input
                    type="text"
                    id="cep"
                    formControlName="cep"
                    [class.invalid]="isInvalido('cep')"
                    placeholder="00000-000"
                    (blur)="buscarCep()">
                  <button type="button" class="btn-buscar-cep" (click)="buscarCep()">
                    Buscar
                  </button>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group flex-2">
                  <label for="endereco">Endere√ßo</label>
                  <input
                    type="text"
                    id="endereco"
                    formControlName="endereco"
                    [class.invalid]="isInvalido('endereco')"
                    placeholder="Rua, Avenida...">
                </div>
                <div class="form-group">
                  <label for="numero">N√∫mero</label>
                  <input
                    type="text"
                    id="numero"
                    formControlName="numero"
                    [class.invalid]="isInvalido('numero')"
                    placeholder="123">
                </div>
              </div>

              <div class="form-group">
                <label for="complemento">Complemento (opcional)</label>
                <input
                  type="text"
                  id="complemento"
                  formControlName="complemento"
                  placeholder="Apto, Bloco...">
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="bairro">Bairro</label>
                  <input
                    type="text"
                    id="bairro"
                    formControlName="bairro"
                    [class.invalid]="isInvalido('bairro')"
                    placeholder="Centro">
                </div>
                <div class="form-group">
                  <label for="cidade">Cidade</label>
                  <input
                    type="text"
                    id="cidade"
                    formControlName="cidade"
                    [class.invalid]="isInvalido('cidade')"
                    placeholder="S√£o Paulo">
                </div>
                <div class="form-group form-group-small">
                  <label for="estado">UF</label>
                  <input
                    type="text"
                    id="estado"
                    formControlName="estado"
                    [class.invalid]="isInvalido('estado')"
                    placeholder="SP"
                    maxlength="2">
                </div>
              </div>
            </div>


            <div class="form-section">
              <h3 class="form-section-title">Tipo de pagamento</h3>

              <div class="payment-methods">
                <button
                  type="button"
                  class="payment-btn"
                  [class.active]="metodoPagamentoSelecionado === 'credito'"
                  (click)="selecionarMetodoPagamento('credito')">
                  üí≥ Cr√©dito
                </button>
                <button
                  type="button"
                  class="payment-btn"
                  [class.active]="metodoPagamentoSelecionado === 'debito'"
                  (click)="selecionarMetodoPagamento('debito')">
                  üí≥ D√©bito
                </button>
                <button
                  type="button"
                  class="payment-btn"
                  [class.active]="metodoPagamentoSelecionado === 'pix'"
                  (click)="selecionarMetodoPagamento('pix')">
                  üì± PIX
                </button>
                <button
                  type="button"
                  class="payment-btn"
                  [class.active]="metodoPagamentoSelecionado === 'boleto'"
                  (click)="selecionarMetodoPagamento('boleto')">
                  üé´ Boleto
                </button>
              </div>


              <div *ngIf="metodoPagamentoSelecionado === 'credito' || metodoPagamentoSelecionado === 'debito'" class="card-fields">
                <div class="form-group">
                  <label for="numeroCartao">N√∫mero do cart√£o</label>
                  <input
                    type="text"
                    id="numeroCartao"
                    formControlName="numeroCartao"
                    [class.invalid]="isInvalido('numeroCartao')"
                    placeholder="0000 0000 0000 0000"
                    maxlength="19">
                </div>

                <div class="form-group">
                  <label for="nomeCartao">Nome no cart√£o</label>
                  <input
                    type="text"
                    id="nomeCartao"
                    formControlName="nomeCartao"
                    [class.invalid]="isInvalido('nomeCartao')"
                    placeholder="Como est√° no cart√£o">
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="validadeCartao">Validade</label>
                    <input
                      type="text"
                      id="validadeCartao"
                      formControlName="validadeCartao"
                      [class.invalid]="isInvalido('validadeCartao')"
                      placeholder="MM/AA"
                      maxlength="5">
                  </div>
                  <div class="form-group">
                    <label for="cvv">CVV</label>
                    <input
                      type="text"
                      id="cvv"
                      formControlName="cvv"
                      [class.invalid]="isInvalido('cvv')"
                      placeholder="123"
                      maxlength="4">
                  </div>
                </div>
              </div>


              <div *ngIf="metodoPagamentoSelecionado === 'pix'" class="payment-info">
                <p>‚úÖ Pagamento instant√¢neo</p>
                <p>‚úÖ Confirma√ß√£o imediata</p>
                <p>O QR Code ser√° gerado ap√≥s a finaliza√ß√£o</p>
              </div>


              <div *ngIf="metodoPagamentoSelecionado === 'boleto'" class="payment-info">
                <p>üìÑ Boleto banc√°rio</p>
                <p>Prazo de compensa√ß√£o: 1-2 dias √∫teis</p>
                <p>O boleto ser√° enviado por e-mail</p>
              </div>
            </div>


            <div class="final-summary">
              <div class="summary-line">
                <span>Subtotal:</span>
                <span>R$ {{ formatarPreco(subtotal) }}</span>
              </div>
              <div class="summary-line">
                <span>Frete:</span>
                <span [class.free]="frete === 0">
                  {{ frete === 0 ? 'GR√ÅTIS' : 'R$ ' + formatarPreco(frete) }}
                </span>
              </div>
              <div class="summary-total">
                <span>Total:</span>
                <span>R$ {{ formatarPreco(total) }}</span>
              </div>
            </div>


            <button type="submit" class="btn-finalizar" [disabled]="checkoutForm.invalid">
              Finalizar pedido
            </button>
          </form>

        </div>

      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-col">
          <h3>Ajuda</h3>
          <p>SAC<br>Trocas e devolu√ß√µes<br>Meus pedidos</p>
        </div>
        <div class="footer-col">
          <h3>Redes sociais</h3>
          <p>Facebook<br>Instagram<br>Twitter</p>
        </div>
        <div class="footer-col">
          <h3>Sobre n√≥s</h3>
          <p>Nossa hist√≥ria<br>Trabalhe conosco<br>Privacidade</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>Formas de pagamento</p>
        <div class="payment-icons">
          üí≥ üè¶ üì± üé´
        </div>
      </div>
    </div>
  </footer>

</div>

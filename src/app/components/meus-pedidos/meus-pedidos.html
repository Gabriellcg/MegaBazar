<div class="meus-pedidos-container">


  <div class="promo-banner">
    Para frete gr√°tis em pedidos acima de R$100,00 ou mais, use o c√≥digo FRETEFREE
  </div>


  <header class="header">
    <div class="container">
      <div class="header-content">
        <h1 class="logo" [routerLink]="['/']">MegaLoja Online</h1>

        <div class="header-icons">
          <button class="icon-btn">üë§</button>
          <button class="icon-btn active">üì¶</button>
          <button class="icon-btn" [routerLink]="['/carrinho']">üõí</button>
        </div>
      </div>
    </div>
  </header>


  <div class="breadcrumb">
    <div class="container">
      <button class="back-btn" (click)="voltarParaHome()">‚Üê Voltar</button>
    </div>
  </div>


  <div *ngIf="loading" class="loading-container">
    <p>Carregando seus pedidos...</p>
  </div>


  <main class="main-content" *ngIf="!loading">
    <div class="container">

      <h1 class="page-title">Meus Pedidos</h1>


      <div *ngIf="pedidos.length === 0" class="empty-orders">
        <div class="empty-icon">üì¶</div>
        <h2>Voc√™ ainda n√£o fez nenhum pedido</h2>
        <p>Explore nossos produtos e fa√ßa sua primeira compra!</p>
        <button class="btn-primary" (click)="voltarParaHome()">
          Ver Produtos
        </button>
      </div>


      <div *ngIf="pedidos.length > 0" class="orders-content">

        <div class="orders-list">
          <div class="order-card" *ngFor="let pedido of pedidos"
            [class.selected]="pedidoSelecionado?.numero === pedido.numero" (click)="selecionarPedido(pedido)">

            <div class="order-header">
              <div class="order-info">
                <span class="order-number">{{ pedido.numero }}</span>
                <span class="order-date">{{ formatarData(pedido.data) }}</span>
              </div>
              <span class="order-status" [ngClass]="getStatusClass(pedido.status)">
                {{ getStatusTexto(pedido.status) }}
              </span>
            </div>

            <div class="order-body">
              <div class="order-items-preview">
                <div class="item-preview" *ngFor="let item of pedido.itens.slice(0, 3)">
                  <img [src]="item.imagem" [alt]="item.nome">

                  <span class="qty-badge" *ngIf="item.quantidade && item.quantidade > 1">
                    {{ item.quantidade }}x
                  </span>
                </div>
                <div class="more-items" *ngIf="pedido.itens.length > 3">
                  +{{ pedido.itens.length - 3 }}
                </div>
              </div>

              <div class="order-summary">
                <p class="total-items">
                  {{ calcularTotalItens(pedido) }} {{ calcularTotalItens(pedido) === 1 ? 'item' : 'itens' }}
                </p>
                <p class="total-value">R$ {{ formatarPreco(pedido.total) }}</p>
              </div>
            </div>

            <div class="order-footer">
              <button class="btn-small btn-outline" (click)="rastrearPedido(pedido); $event.stopPropagation()">
                Rastrear
              </button>
              <button class="btn-small btn-primary" (click)="selecionarPedido(pedido); $event.stopPropagation()">
                Ver detalhes
              </button>
            </div>
          </div>
        </div>

      </div>

    </div>
  </main>


  <div class="modal-overlay" *ngIf="pedidoSelecionado" (click)="fecharDetalhes()">
    <div class="modal-content" (click)="$event.stopPropagation()">

      <div class="modal-header">
        <h2>Detalhes do Pedido</h2>
        <button class="btn-close" (click)="fecharDetalhes()">√ó</button>
      </div>

      <div class="modal-body">


        <div class="pedido-info-section">
          <p class="pedido-numero">N√∫mero do Pedido: <strong>{{ pedidoSelecionado.numero }}</strong></p>
          <p class="pedido-data">{{ formatarData(pedidoSelecionado.data) }}</p>
          <p class="pedido-status">
            Status:
            <span [ngClass]="getStatusClass(pedidoSelecionado.status)">
              {{ getStatusTexto(pedidoSelecionado.status) }}
            </span>
          </p>
        </div>


        <div class="pedido-items">
          <h3>Itens do Pedido</h3>
          <div class="item-detail" *ngFor="let item of pedidoSelecionado.itens">
            <div class="item-image" (click)="irParaProduto(item.id)">
              <img [src]="item.imagem" [alt]="item.nome">
            </div>
            <div class="item-info">
              <h4 (click)="irParaProduto(item.id)">{{ item.nome }}</h4>
              <p class="item-price">R$ {{ formatarPreco(item.preco) }} por unidade</p>
              <p class="item-qty">Quantidade: <strong>{{ getQuantidadeItem(item) }}</strong></p>
              <p class="item-subtotal">
                Subtotal: R$ {{ formatarPreco(calcularSubtotalItem(item.preco, getQuantidadeItem(item))) }}
              </p>
            </div>
          </div>
        </div>

        <div class="pedido-resumo">
          <h3>Resumo do Pedido</h3>
          <div class="resumo-line">
            <span>Subtotal ({{ calcularTotalItens(pedidoSelecionado) }} {{ calcularTotalItens(pedidoSelecionado) === 1 ?
              'item' : 'itens' }}):</span>
            <span>R$ {{ formatarPreco(pedidoSelecionado.subtotal) }}</span>
          </div>
          <div class="resumo-line">
            <span>Frete:</span>
            <span [class.free]="pedidoSelecionado.frete === 0">
              {{ pedidoSelecionado.frete === 0 ? 'GR√ÅTIS' : 'R$ ' + formatarPreco(pedidoSelecionado.frete) }}
            </span>
          </div>
          <div class="resumo-line total">
            <span>Total:</span>
            <span>R$ {{ formatarPreco(pedidoSelecionado.total) }}</span>
          </div>
        </div>


        <div class="pedido-endereco">
          <h3>Endere√ßo de entrega</h3>
          <p><strong>{{ pedidoSelecionado.endereco.logradouro }}, {{ pedidoSelecionado.endereco.numero }}</strong></p>
          <p *ngIf="pedidoSelecionado.endereco.complemento">{{ pedidoSelecionado.endereco.complemento }}</p>
          <p>{{ pedidoSelecionado.endereco.bairro }}</p>
          <p>{{ pedidoSelecionado.endereco.cidade }} - {{ pedidoSelecionado.endereco.estado }}</p>
          <p>CEP: {{ pedidoSelecionado.endereco.cep }}</p>
        </div>

        <div class="pedido-extras">
          <p>üìß Voc√™ receber√° um e-mail quando o pedido for atualizado</p>
          <p>üìç Rua Principal, 100 - Centro, {{ pedidoSelecionado.endereco.cidade }}</p>
          <p>‚è∞ Prazo para entrega: {{ pedidoSelecionado.prazoEntrega }}</p>
        </div>


        <div class="modal-actions">
          <button class="btn-action btn-track" (click)="rastrearPedido(pedidoSelecionado)">
            üìç Rastrear Pedido
          </button>
          <button class="btn-action btn-cancel" (click)="cancelarPedido(pedidoSelecionado)"
            *ngIf="pedidoSelecionado.status === 'aguardando_pagamento'">
            ‚ùå Cancelar Pedido
          </button>
          <button class="btn-action btn-reorder" (click)="recomprar(pedidoSelecionado)">
            üîÑ Comprar Novamente
          </button>
          <button class="btn-action btn-home" (click)="voltarParaHome()">
            üè† Voltar para home
          </button>
        </div>

      </div>

    </div>
  </div>


  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-col">
          <h3>Ajuda</h3>
          <ul>
            <li>SAC</li>
            <li>Trocas e devolu√ß√µes</li>
            <li>Meus pedidos</li>
          </ul>
        </div>
        <div class="footer-col">
          <h3>Sobre</h3>
          <ul>
            <li>Sobre n√≥s</li>
            <li>Trabalhe conosco</li>
            <li>Privacidade</li>
          </ul>
        </div>
        <div class="footer-col">
          <h3>Redes Sociais</h3>
          <ul>
            <li>Facebook</li>
            <li>Instagram</li>
            <li>Twitter</li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>¬© 2024 MegaLoja Online. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>

</div>
